<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books Read per Month</title>
  <style>
    .chart-container {
      margin-bottom: 20px;
    }

    #box {
      display: flex;
      justify-content: center;
      gap: 50px;
      flex-wrap: wrap;
      margin: 20px;
    }

    #box a{
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        text-decoration: none;
        color: rgb(6, 66, 134);
    }

    .chart {
      display: none;
    }

    .axis text {
      font-family: sans-serif;
      font-size: 10px;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }

    .bar {
      fill: steelblue;
    }

    .bar:hover {
      fill: orange;
    }
  </style>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <script>
    function drawChart(year) {
      d3.csv("books.csv").then(function(data) {
        // Filtriranje podataka za određenu godinu
        var filteredData = data.filter(function(d) {
          return d.Year == year;
        });

        // Grupiranje podataka po mjesecima i izračunavanje broja knjiga po mjesecima
        var months = d3.range(1, 13); // Generiranje svih mjeseci od 1 do 12

        var booksReadPerMonth = months.map(function(month) {
          return {
            month: month,
            booksRead: filteredData.filter(function(d) {
              return +d.DateRead.split("/")[1] === month; // Provjera ima li podataka za trenutni mjesec
            }).length
          };
        });

        // Dimenzije grafikona
        var margin = { top: 50, right: 50, bottom: 150, left: 50 }, // Povećanje margin.bottom da bi se oznake na x-osi mogle prikazati
            width = 600 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        // X i Y skale
        var x = d3.scaleBand()
            .domain(months.map(String)) // Konvertiranje mjeseci u stringove radi prikaza na x-osi
            .range([0, width])
            .padding(0.1);

        var y = d3.scaleLinear()
            .domain([0, d3.max(booksReadPerMonth, function(d) { return d.booksRead; })])
            .nice()
            .range([height, 0]);

        // Kreiranje osi
        var xAxis = d3.axisBottom(x)
          .tickFormat(function(d) {
            // Rotacija oznaka na x-osi
            var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return monthNames[parseInt(d) - 1]; // Konvertiranje broja mjesta u indeks mjeseca u nizu
          });

        var yAxis = d3.axisLeft(y)
          .ticks(5);

        // Uklanjanje prethodnog grafikona
        d3.select("#chart").selectAll("*").remove();

        // Kreiranje SVG elementa
        var svg = d3.select("#chart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Dodavanje X osi
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", "rotate(-65)");

        // Dodavanje Y osi
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis);

        // Dodavanje stupčastih elemenata
        svg.selectAll(".bar")
          .data(booksReadPerMonth)
          .enter().append("rect")
            .attr("class", "bar")
            .attr("x", function(d) { return x(String(d.month)); })
            .attr("width", x.bandwidth())
            .attr("y", function(d) { return y(d.booksRead); })
            .attr("height", function(d) { return height - y(d.booksRead); });

        var totalBooks = d3.sum(booksReadPerMonth, function(d) { return d.booksRead; });

        // Tekst pored grafikona koji prikazuje ukupan broj knjiga
        svg.append("text")
        .attr("class", "total-books")
        .attr("x", width / 2)
        .attr("y", height + margin.bottom / 2)
        .attr("text-anchor", "middle")
        .text("Total books read: " + totalBooks);
      });
    }

    // Pokretanje funkcije za crtanje grafikona kada se klikne na godinu
    document.addEventListener("DOMContentLoaded", function() {
      var container = document.createElement("div");
      container.setAttribute("id", "container");
      document.body.appendChild(container);

      var box = document.createElement("div");
      box.setAttribute("id", "box");
      container.appendChild(box);

      var years = [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024]; // Dodajte sve godine koje imate u podacima
      years.forEach(function(year) {
        var link = document.createElement("a");
        link.setAttribute("href", "#");
        link.textContent = year + " ";

        link.addEventListener("click", function() {
          drawChart(year);
        });

        box.appendChild(link);
      });

      var chartDiv = document.createElement("div");
      chartDiv.setAttribute("id", "chart");
      container.appendChild(chartDiv);
    });
  </script>
</body>
</html>
